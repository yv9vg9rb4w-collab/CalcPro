<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CalcPro Géo - Correction Strict</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    :root { --accent: #00ffcc; --bg: #0f0f0f; }
    body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 10px; touch-action: manipulation; }
    
    /* Grille de boutons très claire */
    .btn-group { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 15px; }
    button { 
        background: #222; border: 1px solid #444; color: white; border-radius: 8px;
        padding: 12px 5px; font-weight: bold; width: 22%; min-width: 80px; font-size: 11px;
    }
    button:active { background: var(--accent); color: black; }
    .special { width: 100%; border-color: #ff4d4d; color: #ff4d4d; margin-bottom: 10px; }

    /* Zone d'affichage */
    #ecran { 
        position: relative; width: 100%; height: 350px; background: #000; 
        border: 2px solid #333; border-radius: 15px; overflow: hidden; 
    }
    #leCanvas2D { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
    #leContainer3D { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; }
    
    #info { text-align: center; padding: 15px; color: var(--accent); font-weight: bold; }
</style>
</head>
<body>

<div class="btn-group">
    <button class="special" onclick="toutEffacer()">EFFACER TOUT</button>
    
    <button onclick="btCarre()">CARRÉ</button>
    <button onclick="btRect()">RECTANGLE</button>
    <button onclick="btCercle()">CERCLE</button>
    <button onclick="btTri()">TRIANGLE</button>
    
    <button onclick="btCube()">CUBE 3D</button>
    <button onclick="btSphere()">SPHÈRE 3D</button>
    <button onclick="btCylindre()">CYLINDRE 3D</button>
    <button onclick="btTore()">TORE 3D</button>
</div>

<div id="ecran">
    <canvas id="leCanvas2D"></canvas>
    <div id="leContainer3D"></div>
</div>

<div id="info">Choisissez une forme</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/OrbitControls.js"></script>

<script>
// Variables globales
const canvas = document.getElementById('leCanvas2D');
const ctx = canvas.getContext('2d');
const info = document.getElementById('info');
const container = document.getElementById('leContainer3D');

let scene, camera, renderer, controls, mesh3D = null;

// Initialisation 3D
function initApp() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.z = 5;

    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(2, 2, 5);
    scene.add(light, new THREE.AmbientLight(0x404040));

    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    window.addEventListener('resize', () => {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
    });
    
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
    animate();
}

function toutEffacer() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (mesh3D) { scene.remove(mesh3D); mesh3D = null; }
    info.textContent = "Écran vidé";
}

// FONCTIONS 2D - CORRIGÉES
function btCarre() {
    toutEffacer();
    ctx.fillStyle = "#00ffcc";
    // Un carré parfait : 100 par 100
    ctx.fillRect(canvas.width/2 - 50, canvas.height/2 - 50, 100, 100);
    info.textContent = "CARRÉ : 4 côtés égaux";
}

function btRect() {
    toutEffacer();
    ctx.fillStyle = "#00ffcc";
    // Un rectangle : 160 par 80
    ctx.fillRect(canvas.width/2 - 80, canvas.height/2 - 40, 160, 80);
    info.textContent = "RECTANGLE : Longueur différente de la largeur";
}

function btCercle() {
    toutEffacer();
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, 60, 0, Math.PI*2);
    ctx.fillStyle = "#00ffcc";
    ctx.fill();
    info.textContent = "CERCLE";
}

function btTri() {
    toutEffacer();
    ctx.beginPath();
    ctx.moveTo(canvas.width/2, canvas.height/2 - 60);
    ctx.lineTo(canvas.width/2 - 70, canvas.height/2 + 50);
    ctx.lineTo(canvas.width/2 + 70, canvas.height/2 + 50);
    ctx.closePath();
    ctx.fillStyle = "#00ffcc";
    ctx.fill();
    info.textContent = "TRIANGLE";
}

// FONCTIONS 3D - CORRIGÉES
function lancer3D(geometrie, nom) {
    toutEffacer();
    const material = new THREE.MeshPhongMaterial({ color: 0x00ffcc, flatShading: true });
    mesh3D = new THREE.Mesh(geometrie, material);
    scene.add(mesh3D);
    info.textContent = nom + " 3D (Faites tourner avec votre doigt)";
}

function btCube() { lancer3D(new THREE.BoxGeometry(2,2,2), "CUBE"); }
function btSphere() { lancer3D(new THREE.SphereGeometry(1.5, 32, 32), "SPHÈRE"); }
function btCylindre() { lancer3D(new THREE.CylinderGeometry(1, 1, 3, 32), "CYLINDRE"); }
function btTore() { lancer3D(new THREE.TorusGeometry(1, 0.4, 16, 100), "TORE"); }

function animate() {
    requestAnimationFrame(animate);
    if (mesh3D) mesh3D.rotation.y += 0.01;
    controls.update();
    renderer.render(scene, camera);
}

// Lancement au démarrage
initApp();
</script>
</body>
</html>