<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CalcPro | Géométrie 2D & 3D</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --bg:#0f0f0f;
  --card:#1b1b1b;
  --accent:#00ffcc;
  --text:#ffffff;
  --muted:#aaaaaa;
}
body{
  margin:0; padding:20px;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  background:var(--bg); color:var(--text);
}
header{text-align:center;margin-bottom:20px;}
header h1{margin:0;font-size:2em;color:var(--accent);}
header p{margin-top:5px;color:var(--muted);}

/* BOUTONS */
#controls{
  display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:20px; 
  position:relative; 
  z-index:100; /* On s'assure qu'ils sont tout en haut */
}
#controls button{
  background:var(--card); border:none; border-radius:12px;
  padding:10px 15px; color:var(--text); font-weight:bold;
  cursor:pointer; box-shadow:0 0 10px rgba(0,255,204,0.2);
  transition:0.2s ease;
}
#controls button:hover{
  transform:translateY(-3px) scale(1.05);
  box-shadow:0 0 20px rgba(0,255,204,0.35);
}

/* TABLEAU / CANVAS */
#canvasContainer{
  position:relative; width:90%; max-width:700px; height:400px; margin:auto;
  border-radius:16px; background:#1b1b1b; box-shadow:0 0 20px rgba(0,255,204,0.3);
  overflow:hidden;
}

#canvas2D{
  position:absolute; top:0; left:0; width:100%; height:100%; 
  z-index:10; 
  pointer-events: none; /* CORRECTION : Permet de cliquer à travers le canvas */
}

#threejs-container{
  position:absolute; top:0; left:0; width:100%; height:100%; 
  z-index:5; 
}

#definition{text-align:center;margin-top:10px;color:var(--accent);font-size:16px;}
</style>
</head>
<body>

<header>
<h1>Outil Géométrie CalcPro</h1>
<p>2D & 3D – Une seule figure à la fois</p>
</header>

<div id="controls">
  <div style="width:100%; text-align:center; margin-bottom:5px;"><strong>2D :</strong></div>
  <button onclick="drawShape2D('carré')">Carré</button>
  <button onclick="drawShape2D('rectangle')">Rectangle</button>
  <button onclick="drawShape2D('cercle')">Cercle</button>
  <button onclick="drawShape2D('triangle')">Triangle</button>
  <button onclick="drawShape2D('equilateral')">Équilatéral</button>
  <button onclick="drawShape2D('isocele')">Isocèle</button>
  <button onclick="drawShape2D('scalene')">Scalène</button>

  <div style="width:100%; text-align:center; margin:10px 0 5px 0;"><strong>3D :</strong></div>
  <button onclick="draw3DShape('cube')">Cube</button>
  <button onclick="draw3DShape('sphere')">Sphère</button>
  <button onclick="draw3DShape('cylindre')">Cylindre</button>
  <button onclick="draw3DShape('cone')">Cône</button>
  <button onclick="draw3DShape('pyramide')">Pyramide</button>
  <button onclick="draw3DShape('tore')">Tore</button>
</div>

<div id="canvasContainer">
  <canvas id="canvas2D"></canvas>
  <div id="threejs-container"></div>
</div>

<div id="definition">Sélectionne une figure pour voir sa définition</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/OrbitControls.js"></script>
<script>
// ==== 2D CANVAS ====
const canvas2D = document.getElementById('canvas2D');
const ctx = canvas2D.getContext('2d');
const def = document.getElementById('definition');

function resizeCanvas(){
  canvas2D.width = canvas2D.offsetWidth;
  canvas2D.height = canvas2D.offsetHeight;
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

// ==== 3D THREE.JS ====
const container3D = document.getElementById('threejs-container');
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x1b1b1b);

const camera = new THREE.PerspectiveCamera(75, container3D.clientWidth/container3D.clientHeight, 0.1, 1000);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({alpha:true, antialias:true});
renderer.setSize(container3D.clientWidth,container3D.clientHeight);
container3D.appendChild(renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,5,5);
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040));

// On lie les contrôles au container et non au document
const controls3D = new THREE.OrbitControls(camera, renderer.domElement);
controls3D.enablePan = false;
controls3D.enableDamping = true;

// ==== VARIABLES ====
let current3D = null;

function clearCanvas(){
  ctx.clearRect(0,0,canvas2D.width,canvas2D.height);
  if(current3D){ scene.remove(current3D); current3D = null; }
}

function drawShape2D(shape){
  clearCanvas();
  ctx.fillStyle="#00ffcc";
  const centerX = canvas2D.width / 2;
  const centerY = canvas2D.height / 2;

  switch(shape){
    case 'carré': ctx.fillRect(centerX-50,centerY-50,100,100); def.textContent="Carré : 4 côtés égaux et angles droits."; break;
    case 'rectangle': ctx.fillRect(centerX-70,centerY-50,140,100); def.textContent="Rectangle : côtés opposés égaux."; break;
    case 'cercle': ctx.beginPath(); ctx.arc(centerX,centerY,60,0,2*Math.PI); ctx.fill(); def.textContent="Cercle : ensemble de points équidistants d’un centre."; break;
    case 'triangle': 
    case 'equilateral':
    case 'isocele':
    case 'scalene':
        ctx.beginPath(); ctx.moveTo(centerX,centerY-60); ctx.lineTo(centerX-70,centerY+60); ctx.lineTo(centerX+70,centerY+60); ctx.closePath(); ctx.fill(); 
        def.textContent="Triangle : polygone à trois côtés."; break;
  }
}

function draw3DShape(shape){
  clearCanvas();
  let geometry;
  switch(shape){
    case 'cube': geometry=new THREE.BoxGeometry(2,2,2); def.textContent="Cube : 6 faces carrées."; break;
    case 'sphere': geometry=new THREE.SphereGeometry(1.5,32,32); def.textContent="Sphère : points équidistants d’un centre."; break;
    case 'cylindre': geometry=new THREE.CylinderGeometry(1,1,3,32); def.textContent="Cylindre : bases circulaires."; break;
    case 'cone': geometry=new THREE.ConeGeometry(1.5,3,32); def.textContent="Cône : base circulaire et sommet unique."; break;
    case 'pyramide': geometry=new THREE.ConeGeometry(1.5,3,4); def.textContent="Pyramide : base polygonale et sommet."; break;
    case 'tore': geometry=new THREE.TorusGeometry(1,0.4,16,100); def.textContent="Tore : anneau 3D."; break;
  }
  const material = new THREE.MeshPhongMaterial({color:0x00ffcc,flatShading:true});
  current3D = new THREE.Mesh(geometry,material);
  scene.add(current3D);
}

function animate(){
  requestAnimationFrame(animate);
  if(current3D) current3D.rotation.y +=0.01;
  controls3D.update();
  renderer.render(scene,camera);
}
animate();

window.addEventListener('resize', ()=>{
  camera.aspect = container3D.clientWidth/container3D.clientHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(container3D.clientWidth,container3D.clientHeight);
});
</script>
</body>
</html>