<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CalcPro Géo - Version Finale</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
    :root { --accent: #00ffcc; --bg: #0f0f0f; --danger: #ff4d4d; }
    body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 10px; touch-action: manipulation; }
    
    /* Menu vertical pour ne pas bloquer les boutons à droite sur mobile */
    .menu { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    
    button { 
        background: #222; border: 1px solid #444; color: white; border-radius: 10px;
        padding: 15px 5px; font-weight: bold; font-size: 14px; cursor: pointer;
    }
    button:active { background: var(--accent); color: black; }
    .btn-clear { background: #331111; border-color: var(--danger); color: var(--danger); width: 100%; }
    
    .label { text-align: center; color: var(--muted); font-size: 12px; margin-top: 10px; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 5px;}

    #ecran { 
        position: relative; width: 100%; height: 300px; background: #000; 
        border: 2px solid #333; border-radius: 15px; overflow: hidden; 
    }
    #canvas2D { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
    #container3D { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; }
    
    #definition { text-align: center; padding: 15px; color: var(--accent); font-weight: bold; min-height: 40px; }
</style>
</head>
<body>

<div class="menu">
    <button class="btn-clear" onclick="actionEffacer()">EFFACER TOUT</button>
    
    <div class="label">Figures 2D</div>
    <div class="row">
        <button onclick="dessinCarre()">CARRÉ (4 côtés =)</button>
        <button onclick="dessinRect()">RECTANGLE</button>
    </div>
    <div class="row">
        <button onclick="dessinCercle()">CERCLE</button>
        <button onclick="dessinTri()">TRIANGLE</button>
    </div>
    <div class="row">
        <button onclick="dessinPenta()">PENTAGONE</button>
        <button onclick="dessinHexa()">HEXAGONE</button>
    </div>

    <div class="label">Figures 3D</div>
    <div class="row">
        <button onclick="vraiCube()">CUBE</button>
        <button onclick="vraiSphere()">SPHÈRE</button>
    </div>
    <div class="row">
        <button onclick="vraiCylindre()">CYLINDRE</button>
        <button onclick="vraiCone()">CÔNE</button>
    </div>
    <div class="row">
        <button onclick="vraiPyramide()">PYRAMIDE</button>
        <button onclick="vraiTore()">TORE (ANNEAU)</button>
    </div>
</div>

<div id="ecran">
    <canvas id="canvas2D"></canvas>
    <div id="container3D"></div>
</div>

<div id="definition">Choisissez une figure ci-dessus</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/OrbitControls.js"></script>

<script>
const canvas = document.getElementById('canvas2D');
const ctx = canvas.getContext('2d');
const def = document.getElementById('definition');
const container = document.getElementById('container3D');

let scene, camera, renderer, controls, objet3D = null;

// INIT
function initialiser() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
    camera.position.z = 5;

    renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    const light = new THREE.PointLight(0xffffff, 1, 100);
    light.position.set(10, 10, 10);
    scene.add(light, new THREE.AmbientLight(0x404040));

    controls = new THREE.OrbitControls(camera, renderer.domElement);
    
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
    
    window.addEventListener('resize', () => {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
    });
    boucle();
}

function actionEffacer() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (objet3D) { scene.remove(objet3D); objet3D = null; }
    def.textContent = "Écran vidé";
}

// --- FIGURES 2D ---
function dessinCarre() {
    actionEffacer();
    ctx.fillStyle = "#00ffcc";
    // Carré strict : 100x100
    ctx.fillRect(canvas.width/2 - 50, canvas.height/2 - 50, 100, 100);
    def.textContent = "CARRÉ : 4 côtés égaux, 4 angles droits.";
}

function dessinRect() {
    actionEffacer();
    ctx.fillStyle = "#00ffcc";
    // Rectangle strict : 160x80
    ctx.fillRect(canvas.width/2 - 80, canvas.height/2 - 40, 160, 80);
    def.textContent = "RECTANGLE : Longueur (160) différente de la largeur (80).";
}

function dessinCercle() {
    actionEffacer();
    ctx.beginPath();
    ctx.arc(canvas.width/2, canvas.height/2, 60, 0, Math.PI*2);
    ctx.fillStyle = "#00ffcc";
    ctx.fill();
    def.textContent = "CERCLE : Figure parfaitement ronde.";
}

function dessinTri() {
    actionEffacer();
    ctx.beginPath();
    ctx.moveTo(canvas.width/2, canvas.height/2 - 60);
    ctx.lineTo(canvas.width/2 - 70, canvas.height/2 + 50);
    ctx.lineTo(canvas.width/2 + 70, canvas.height/2 + 50);
    ctx.closePath();
    ctx.fillStyle = "#00ffcc";
    ctx.fill();
    def.textContent = "TRIANGLE : 3 côtés.";
}

function dessinPenta() {
    actionEffacer();
    const x = canvas.width/2, y = canvas.height/2, r = 60;
    ctx.beginPath();
    for(let i=0; i<5; i++) {
        ctx.lineTo(x + r*Math.cos(i*2*Math.PI/5 - Math.PI/2), y + r*Math.sin(i*2*Math.PI/5 - Math.PI/2));
    }
    ctx.closePath(); ctx.fillStyle = "#00ffcc"; ctx.fill();
    def.textContent = "PENTAGONE : 5 côtés.";
}

function dessinHexa() {
    actionEffacer();
    const x = canvas.width/2, y = canvas.height/2, r = 60;
    ctx.beginPath();
    for(let i=0; i<6; i++) {
        ctx.lineTo(x + r*Math.cos(i*2*Math.PI/6 - Math.PI/2), y + r*Math.sin(i*2*Math.PI/6 - Math.PI/2));
    }
    ctx.closePath(); ctx.fillStyle = "#00ffcc"; ctx.fill();
    def.textContent = "HEXAGONE : 6 côtés.";
}

// --- FIGURES 3D ---
function lancer3D(geo, txt) {
    actionEffacer();
    objet3D = new THREE.Mesh(geo, new THREE.MeshPhongMaterial({color: 0x00ffcc, flatShading: true}));
    scene.add(objet3D);
    def.textContent = txt + " (Touchez pour faire tourner)";
}

function vraiCube() { lancer3D(new THREE.BoxGeometry(2,2,2), "CUBE 3D"); }
function vraiSphere() { lancer3D(new THREE.SphereGeometry(1.5, 32, 32), "SPHÈRE 3D"); }
function vraiCylindre() { lancer3D(new THREE.CylinderGeometry(1, 1, 3, 32), "CYLINDRE 3D"); }
function vraiCone() { lancer3D(new THREE.ConeGeometry(1.5, 3, 32), "CÔNE 3D"); }
function vraiPyramide() { lancer3D(new THREE.ConeGeometry(1.8, 2.5, 4), "PYRAMIDE 3D"); }
function vraiTore() { lancer3D(new THREE.TorusGeometry(1, 0.4, 16, 100), "TORE 3D"); }

function boucle() {
    requestAnimationFrame(boucle);
    if (objet3D) objet3D.rotation.y += 0.01;
    controls.update();
    renderer.render(scene, camera);
}

initialiser();
</script>
</body>
</html>