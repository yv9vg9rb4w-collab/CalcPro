<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CalcPro Mobile | Géométrie</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
:root{
  --bg:#0f0f0f;
  --card:#1b1b1b;
  --accent:#00ffcc;
  --text:#ffffff;
  --muted:#aaaaaa;
}
body{
  margin:0; padding:15px;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  background:var(--bg); color:var(--text);
  touch-action: manipulation; /* Optimise le tactile */
}
header{text-align:center;margin-bottom:15px;}
header h1{margin:0;font-size:1.5em;color:var(--accent);}

/* CONTROLES : On booste le z-index pour le mobile */
#controls{
  display:flex; flex-wrap:wrap; gap:8px; justify-content:center; 
  margin-bottom:20px;
  position:relative;
  z-index:9999; /* Toujours au-dessus de tout */
}
#controls button{
  background:var(--card); border:1px solid #333; border-radius:10px;
  padding:12px 10px; color:var(--text); font-weight:bold;
  cursor:pointer; font-size: 13px;
  flex: 1 1 28%; /* S'adapte mieux aux petits écrans */
  min-width: 80px;
}

#canvasContainer{
  position:relative; width:100%; height:300px; margin:auto;
  border-radius:16px; background:#1b1b1b; 
  overflow:hidden;
  touch-action: none; /* Laisse Three.js gérer le tactile */
}

/* LA CORRECTION MOBILE ICI */
#canvas2D{
  position:absolute; top:0; left:0; width:100%; height:100%; 
  z-index:10; 
  pointer-events: none; /* TES DOIGTS PASSENT À TRAVERS POUR CLIQUER LES BOUTONS */
}

#threejs-container{
  position:absolute; top:0; left:0; width:100%; height:100%; 
  z-index:5;
}

#definition{text-align:center;margin-top:15px;color:var(--accent);min-height:40px;font-size:14px;}
</style>
</head>
<body>

<header>
  <h1>CalcPro Géo</h1>
</header>

<div id="controls">
  <button onclick="drawShape2D('carré')">Carré</button>
  <button onclick="drawShape2D('cercle')">Cercle</button>
  <button onclick="drawShape2D('triangle')">Triangle</button>
  <button onclick="draw3DShape('cube')">Cube 3D</button>
  <button onclick="draw3DShape('sphere')">Sphère 3D</button>
  <button onclick="draw3DShape('tore')">Tore 3D</button>
</div>

<div id="canvasContainer">
  <canvas id="canvas2D"></canvas>
  <div id="threejs-container"></div>
</div>

<div id="definition">Clique sur un bouton pour commencer</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/controls/OrbitControls.js"></script>
<script>
const canvas2D = document.getElementById('canvas2D');
const ctx = canvas2D.getContext('2d');
const def = document.getElementById('definition');
const container3D = document.getElementById('threejs-container');

function resize(){
  canvas2D.width = canvas2D.offsetWidth;
  canvas2D.height = canvas2D.offsetHeight;
  if(renderer){
    camera.aspect = container3D.clientWidth / container3D.clientHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(container3D.clientWidth, container3D.clientHeight);
  }
}
window.addEventListener('resize', resize);

// Setup 3D
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x1b1b1b);
const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({antialias:true});
container3D.appendChild(renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,5,5);
scene.add(light, new THREE.AmbientLight(0x404040));

const controls3D = new THREE.OrbitControls(camera, renderer.domElement);
let current3D = null;

function clear(){
  ctx.clearRect(0,0,canvas2D.width,canvas2D.height);
  if(current3D) { scene.remove(current3D); current3D = null; }
}

function drawShape2D(shape){
  clear();
  ctx.fillStyle="#00ffcc";
  const x = canvas2D.width/2, y = canvas2D.height/2;
  if(shape==='carré') ctx.fillRect(x-50,y-50,100,100);
  if(shape==='cercle') { ctx.beginPath(); ctx.arc(x,y,50,0,Math.PI*2); ctx.fill(); }
  if(shape==='triangle') { ctx.beginPath(); ctx.moveTo(x,y-50); ctx.lineTo(x-60,y+50); ctx.lineTo(x+60,y+50); ctx.fill(); }
  def.textContent = "Figure 2D : " + shape;
}

function draw3DShape(shape){
  clear();
  let geo;
  if(shape==='cube') geo = new THREE.BoxGeometry(2,2,2);
  if(shape==='sphere') geo = new THREE.SphereGeometry(1.5,32,32);
  if(shape==='tore') geo = new THREE.TorusGeometry(1,0.4,16,100);
  current3D = new THREE.Mesh(geo, new THREE.MeshPhongMaterial({color:0x00ffcc}));
  scene.add(current3D);
  def.textContent = "Figure 3D : " + shape + " (Fais glisser pour tourner)";
}

function animate(){
  requestAnimationFrame(animate);
  if(current3D) current3D.rotation.y += 0.01;
  controls3D.update();
  renderer.render(scene, camera);
}
resize();
animate();
</script>
</body>
</html>