<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CalcPro â€¢ GeoGraph Max</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    background:linear-gradient(135deg,#0f172a,#020617);
    font-family:Arial,sans-serif;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    min-height:100vh;
    padding:20px;
    color:white;
}
.box{
    width:95%;
    max-width:1000px;
    background:#020617;
    border-radius:20px;
    padding:25px;
    box-shadow:0 30px 60px rgba(0,0,0,.6);
}
.title{
    text-align:center;
    font-size:24px;
    font-weight:bold;
    color:#38bdf8;
    margin-bottom:15px;
}
input{
    width:100%;
    padding:14px;
    border-radius:12px;
    border:1px solid #334155;
    background:#0f172a;
    color:#22c55e;
    font-size:18px;
    margin-bottom:10px;
}
canvas{
    margin-top:15px;
    border-radius:15px;
    background:#0f172a;
}
.result{
    margin-top:15px;
    color:#facc15;
}
.btns{
    display:flex;
    gap:10px;
    margin-bottom:10px;
}
button{
    flex:1;
    padding:10px;
    font-weight:bold;
    border:none;
    border-radius:10px;
    cursor:pointer;
}
.zoomIn{background:#22c55e;color:black;}
.zoomOut{background:#ef4444;color:white;}
.clear{background:#38bdf8;color:black;}
</style>
</head>
<body>

<div class="box">
<div class="title">ðŸ“Š CalcPro â€¢ GeoGraph Max</div>

<input id="fx" placeholder="Ex: x^2-3x+2, sin(x), ln(x), 1/x, racin(x), e^x">

<div class="btns">
<button class="zoomIn" onclick="zoom(0.5)">ZOOM +</button>
<button class="zoomOut" onclick="zoom(2)">ZOOM -</button>
<button class="clear" onclick="resetGraph()">RESET</button>
</div>

<div class="result" id="res"></div>
<canvas id="graph2D"></canvas>

</div>

<script>
let ctx = document.getElementById("graph2D");
let chart;
let scale = 10;

function parseFunction(f,x){
    return f.replace(/\^/g,"**")
            .replace(/racin/gi,"Math.sqrt")
            .replace(/sin/gi,"Math.sin")
            .replace(/cos/gi,"Math.cos")
            .replace(/tg/gi,"Math.tan")
            .replace(/tan/gi,"Math.tan")
            .replace(/ln/gi,"Math.log")
            .replace(/log/gi,"Math.log10")
            .replace(/e/gi,"Math.E")
            .replace(/Ï€/gi,"Math.PI")
            .replace(/x/gi,`(${x})`)
            .replace(/abs/gi,"Math.abs")
            .replace(/sqrt/gi,"Math.sqrt");
}

function draw(){
    const f = document.getElementById("fx").value;
    const res = document.getElementById("res");
    if(!f) return;

    let xVals=[], yVals=[], sumY=0, points=[], axisSymmetry=null;

    for(let x=-scale;x<=scale;x+=0.1){
        try{
            let y = eval(parseFunction(f,x));
            if(isFinite(y)){
                xVals.push(x.toFixed(2));
                yVals.push(y);
                sumY += y;
                points.push({x:x.toFixed(2),y:y.toFixed(2)});
            }
        }catch{}
    }

    // Axe de symÃ©trie pour parabole ax^2+bx+c
    let fNorm = f.replace(/\s/g,'');
    let matchA = fNorm.match(/([+-]?\d*)x\^2/);
    let matchB = fNorm.match(/([+-]?\d*)x(?!\^)/);
    if(matchA){
        let a = matchA[1]==""||matchA[1]=="+" ? 1 : matchA[1]=="-" ? -1 : Number(matchA[1]);
        let b = matchB ? (matchB[1]==""||matchB[1]=="+" ? 1 : matchB[1]=="-" ? -1 : Number(matchB[1])) : 0;
        axisSymmetry = -b/(2*a);
    }

    if(chart) chart.destroy();

    chart = new Chart(ctx,{
        type:'line',
        data:{
            labels:xVals,
            datasets:[{
                label:"f(x) = "+f,
                data:yVals,
                borderColor:'#38bdf8',
                tension:0.3,
                pointRadius:4,
                pointBackgroundColor:'#facc15'
            }]
        },
        options:{
            responsive:true,
            plugins:{
                legend:{labels:{color:'white'}}
            },
            scales:{
                x:{grid:{color:'#1e293b'},ticks:{color:'#22c55e'}},
                y:{grid:{color:'#1e293b'},ticks:{color:'#22c55e'}}
            }
        }
    });

    // Affichage points, Î£, axe de symÃ©trie
    let txt = `ðŸ“ Points: ${points.length} | Î£y â‰ˆ ${sumY.toFixed(2)}`;
    if(axisSymmetry!==null) txt += ` | Axe de symÃ©trie: x=${axisSymmetry.toFixed(2)}`;
    res.innerHTML = txt;
}

// Zoom
function zoom(factor){ scale*=factor; draw(); }

// Reset
function resetGraph(){
    document.getElementById("fx").value="";
    document.getElementById("res").innerHTML="";
    if(chart) chart.destroy();
}

// Event input
document.getElementById("fx").addEventListener("input",draw);
draw();
</script>

</body>
</html>
