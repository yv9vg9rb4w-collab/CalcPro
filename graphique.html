<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CalcPro PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
<script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>

<style>
body{
    margin:0;
    background:#0f172a;
    font-family:Arial;
    color:white;
    transition:0.3s;
}
.light{
    background:white;
    color:black;
}
#box{
    width:90vw;
    height:70vh;
    margin:20px auto;
    border:2px solid #38bdf8;
    border-radius:15px;
}
.input-container{
    text-align:center;
}
input{
    width:45%;
    padding:10px;
    font-size:18px;
    border-radius:10px;
    border:none;
    text-align:center;
}
button{
    padding:10px 15px;
    margin:5px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
}
#info{
    max-width:90vw;
    margin:10px auto;
    padding:15px;
    border-radius:15px;
    background:#111827;
    color:#facc15;
}
.light #info{
    background:#e5e7eb;
    color:black;
}
</style>
</head>
<body>

<div id="box"></div>

<div class="input-container">
<input id="fx" placeholder="f(x)">
<input id="gx" placeholder="g(x)">
<br>
<button onclick="drawFunctions()">Tracer</button>
<button onclick="calculateDerivative()">D√©riv√©e f'(x)</button>
<button onclick="findIntersection()">Intersection</button>
<button onclick="toggleMode()">üåó Mode</button>
<button onclick="resetGraph()">Reset</button>
</div>

<div id="info"></div>

<script>

const board = JXG.JSXGraph.initBoard('box',{
    boundingbox:[-10,10,10,-10],
    axis:true,
    grid:true
});

board.defaultAxes.x.ticks.majorUnit = 1;
board.defaultAxes.y.ticks.majorUnit = 1;

let curves = [];

function parseFunction(f){
    f = f.replace(/(\d)x/g,"$1*x");
    f = f.replace(/\^/g,"**");
    f = f.replace(/racin/gi,"Math.sqrt");
    f = f.replace(/sin/gi,"Math.sin");
    f = f.replace(/cos/gi,"Math.cos");
    f = f.replace(/tg/gi,"Math.tan");
    f = f.replace(/tan/gi,"Math.tan");
    return f;
}

function buildFunction(expr){
    let parsed = parseFunction(expr);
    return new Function('x','return '+parsed);
}

function drawFunctions(){
    resetCurves();

    let fInput = document.getElementById('fx').value;
    let gInput = document.getElementById('gx').value;

    if(fInput){
        let f = buildFunction(fInput);
        let curve = board.create('functiongraph',[f],{strokeColor:'blue'});
        curves.push({func:f, curve:curve});
    }

    if(gInput){
        let g = buildFunction(gInput);
        let curve = board.create('functiongraph',[g],{strokeColor:'red'});
        curves.push({func:g, curve:curve});
    }

    document.getElementById('info').innerHTML="Fonctions trac√©es.";
}

function calculateDerivative(){

    if(curves.length===0) return;

    let f = curves[0].func;

    let derivative = function(x){
        let h = 0.0001;
        return (f(x+h)-f(x-h))/(2*h);
    };

    board.create('functiongraph',[derivative],{strokeColor:'green'});
    document.getElementById('info').innerHTML="D√©riv√©e num√©rique affich√©e en vert.";
}

function findIntersection(){

    if(curves.length<2){
        document.getElementById('info').innerHTML="Il faut deux fonctions.";
        return;
    }

    let f = curves[0].func;
    let g = curves[1].func;

    for(let x=-10; x<=10; x+=0.1){
        if(Math.abs(f(x)-g(x))<0.1){
            board.create('point',[x,f(x)],{size:4,color:'yellow'});
            document.getElementById('info').innerHTML="Intersection trouv√©e.";
            return;
        }
    }

    document.getElementById('info').innerHTML="Pas d'intersection visible.";
}

function toggleMode(){
    document.body.classList.toggle('light');
}

function resetCurves(){
    curves.forEach(c=>board.removeObject(c.curve));
    curves=[];
}

function resetGraph(){
    resetCurves();
    board.removeObject(board.objectsList.filter(o=>o.elType==='point'));
    document.getElementById('info').innerHTML="";
}

</script>

</body>
</html>
