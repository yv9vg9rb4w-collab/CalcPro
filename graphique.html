<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CalcPro â€¢ Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    background: linear-gradient(135deg,#0f172a,#020617);
    font-family: Arial,sans-serif;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    min-height:100vh;
    padding:20px;
    color:white;
}
.box{
    width:95%;
    max-width:1100px;
    background:#020617;
    border-radius:20px;
    padding:25px;
    box-shadow:0 30px 60px rgba(0,0,0,.6);
}
.title{
    text-align:center;
    font-size:24px;
    font-weight:bold;
    color:#38bdf8;
    margin-bottom:15px;
}
textarea{
    width:100%;
    height:60px;
    padding:12px;
    border-radius:12px;
    border:1px solid #334155;
    background:#0f172a;
    color:#22c55e;
    font-size:18px;
    margin-bottom:10px;
}
canvas{
    margin-top:15px;
    border-radius:15px;
    background:#0f172a;
}
.result{
    margin-top:15px;
    color:#facc15;
}
.btns{
    display:flex;
    gap:10px;
    margin-bottom:10px;
}
button{
    flex:1;
    padding:10px;
    font-weight:bold;
    border:none;
    border-radius:10px;
    cursor:pointer;
}
.zoomIn{background:#22c55e;color:black;}
.zoomOut{background:#ef4444;color:white;}
.clear{background:#38bdf8;color:black;}
</style>
</head>
<body>

<div class="box">
<div class="title">ðŸ“Š CalcPro â€¢ GeoGraph Ultimate</div>

<textarea id="fxs" placeholder="Entrez plusieurs fonctions sÃ©parÃ©es par des virgules, ex: x^2-2*x+1, sin(x), 1/x"></textarea>

<div class="btns">
<button class="zoomIn" onclick="zoom(0.5)">ZOOM +</button>
<button class="zoomOut" onclick="zoom(2)">ZOOM -</button>
<button class="clear" onclick="resetGraph()">RESET</button>
</div>

<div class="result" id="res"></div>
<canvas id="graph2D"></canvas>
</div>

<script>
let ctx = document.getElementById("graph2D");
let chart;
let scale = 10;
let colors = ['#38bdf8','#f472b6','#22c55e','#facc15','#8b5cf6','#fb923c','#3b82f6','#ec4899'];

// Parse fonction
function parseFunction(f,x){
    try{
        return f.replace(/\^/g,"**")
                .replace(/racin/gi,"Math.sqrt")
                .replace(/sqrt/gi,"Math.sqrt")
                .replace(/sin/gi,"Math.sin")
                .replace(/cos/gi,"Math.cos")
                .replace(/tg/gi,"Math.tan")
                .replace(/tan/gi,"Math.tan")
                .replace(/ln/gi,"Math.log")
                .replace(/log/gi,"Math.log10")
                .replace(/e/gi,"Math.E")
                .replace(/Ï€/gi,"Math.PI")
                .replace(/abs/gi,"Math.abs")
                .replace(/x/gi,`(${x})`);
    } catch {
        return "0";
    }
}

function draw(){
    let input = document.getElementById("fxs").value;
    let res = document.getElementById("res");
    if(!input) return;

    let funcs = input.split(',').map(f=>f.trim());
    let xVals=[], datasets=[], intersections=[];

    for(let i=0;i<funcs.length;i++){
        let f = funcs[i];
        let yVals=[], prevY=null;
        for(let x=-scale; x<=scale; x+=0.1){
            let y=NaN;
            try{ y = eval(parseFunction(f,x)); } catch{}
            if(isFinite(y)) yVals.push(y);
            else yVals.push(null);
            if(prevY!==null && Math.abs(prevY-y)<0.1){
                intersections.push({x:x.toFixed(2),y:y.toFixed(2)});
            }
            prevY=y;
            if(i===0) xVals.push(x.toFixed(2));
        }
        datasets.push({label:f,data:yVals,borderColor:colors[i%colors.length],tension:0.3,pointRadius:0});
    }

    if(chart) chart.destroy();
    chart = new Chart(ctx,{
        type:'line',
        data:{labels:xVals,datasets:datasets},
        options:{
            responsive:true,
            plugins:{legend:{labels:{color:'white'}}},
            scales:{
                x:{grid:{color:'#1e293b'},ticks:{color:'#22c55e'}},
                y:{grid:{color:'#1e293b'},ticks:{color:'#22c55e'}}
            }
        }
    });

    if(intersections.length>0){
        let txt = "ðŸŽ¯ Intersections: ";
        intersections.forEach(p=>{txt+=`(${p.x},${p.y}) `;});
        res.innerHTML = txt;
    } else res.innerHTML = "Pas d'intersections dÃ©tectÃ©es";
}

// Zoom
function zoom(factor){ scale*=factor; draw(); }

// Reset
function resetGraph(){
    document.getElementById("fxs").value="";
    document.getElementById("res").innerHTML="";
    if(chart) chart.destroy();
}

// Event input
document.getElementById("fxs").addEventListener("input",draw);
draw();
</script>

</body>
</html>
