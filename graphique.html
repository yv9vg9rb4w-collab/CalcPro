<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>CalcPro GeoGraph</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Librairies -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>

<style>
body{
    margin:0;
    background:linear-gradient(135deg,#0f172a,#020617);
    font-family:Arial,sans-serif;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    min-height:100vh;
    padding:20px;
    color:white;
}
.box{
    width:95%;
    max-width:1000px;
    background:#020617;
    border-radius:20px;
    padding:20px;
    box-shadow:0 30px 60px rgba(0,0,0,.6);
}
.title{
    text-align:center;
    font-size:24px;
    font-weight:bold;
    color:#38bdf8;
    margin-bottom:15px;
}
input{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:1px solid #334155;
    background:#0f172a;
    color:#22c55e;
    font-size:18px;
    margin-bottom:10px;
}
canvas{
    margin-top:15px;
    border-radius:15px;
    background:#0f172a;
}
.result{
    margin-top:10px;
    color:#facc15;
}
.btns{
    display:flex;
    gap:10px;
    margin-bottom:10px;
}
button{
    flex:1;
    padding:10px;
    font-weight:bold;
    border:none;
    border-radius:10px;
    cursor:pointer;
}
.zoomIn{background:#22c55e;color:black;}
.zoomOut{background:#ef4444;color:white;}
.clear{background:#38bdf8;color:black;}
.switch3D{background:#f472b6;color:black;}
</style>
</head>
<body>

<div class="box">
<div class="title">ðŸ“Š CalcPro â€¢ GeoGraph</div>

<input id="fx1" placeholder="Courbe 1: ex x^2+2x-3">
<input id="fx2" placeholder="Courbe 2: ex x^3-x">

<div class="btns">
<button class="zoomIn" onclick="zoom(0.5)">ZOOM +</button>
<button class="zoomOut" onclick="zoom(2)">ZOOM -</button>
<button class="clear" onclick="resetGraph()">RESET</button>
<button class="switch3D" onclick="switch3D()">3D</button>
</div>

<div class="result" id="res"></div>
<canvas id="graph2D"></canvas>
<div id="graph3D" style="width:100%;height:500px;display:none;margin-top:15px;"></div>
</div>

<script>
let ctx = document.getElementById("graph2D");
let chart;
let scale = 10;

// Dessin 2D
function parseFunction(f,x){
    return f.replace(/\^/g,"**")
            .replace(/racin/gi,"Math.sqrt")
            .replace(/sin/gi,"Math.sin")
            .replace(/cos/gi,"Math.cos")
            .replace(/tg/gi,"Math.tan")
            .replace(/tan/gi,"Math.tan")
            .replace(/log/gi,"Math.log10")
            .replace(/ln/gi,"Math.log")
            .replace(/Ï€/gi,"Math.PI")
            .replace(/x/gi,`(${x})`);
}

function draw2D(){
    const f1 = document.getElementById("fx1").value;
    const f2 = document.getElementById("fx2").value;
    const res = document.getElementById("res");
    let xVals = [], y1=[], y2=[], intersections=[];

    for(let x=-scale;x<=scale;x+=0.1){
        try{
            let yVal1 = eval(parseFunction(f1,x));
            let yVal2 = eval(parseFunction(f2,x));
            if(isFinite(yVal1) && isFinite(yVal2)){
                xVals.push(x.toFixed(2));
                y1.push(yVal1);
                y2.push(yVal2);
                if(Math.abs(yVal1-yVal2)<0.1){
                    intersections.push({x:x.toFixed(2),y:yVal1.toFixed(2)});
                }
            }
        }catch{}
    }

    if(chart) chart.destroy();

    chart = new Chart(ctx,{
        type:'line',
        data:{
            labels:xVals,
            datasets:[
                {label:"y = "+f1,data:y1,borderColor:'#38bdf8',tension:0.3,pointRadius:0},
                {label:"y = "+f2,data:y2,borderColor:'#f472b6',tension:0.3,pointRadius:0}
            ]
        },
        options:{
            responsive:true,
            plugins:{
                legend:{labels:{color:'white'}}
            },
            scales:{
                x:{grid:{color:'#1e293b'},ticks:{color:'#22c55e'}},
                y:{grid:{color:'#1e293b'},ticks:{color:'#22c55e'}}
            }
        }
    });

    if(intersections.length>0){
        let txt = "ðŸŽ¯ Intersections : ";
        intersections.forEach(p=>{txt+=`(${p.x},${p.y}) `});
        res.innerHTML=txt;
    } else res.innerHTML="";
}

// Zoom
function zoom(factor){ scale*=factor; draw2D(); }

// Reset
function resetGraph(){
    document.getElementById("fx1").value="";
    document.getElementById("fx2").value="";
    document.getElementById("res").innerHTML="";
    if(chart) chart.destroy();
}

// Update quand on Ã©crit
document.getElementById("fx1").addEventListener("input",draw2D);
document.getElementById("fx2").addEventListener("input",draw2D);

// ðŸŽ¨ 3D
let scene, camera, renderer, controls;
function switch3D(){
    const c2D = document.getElementById("graph2D");
    const c3D = document.getElementById("graph3D");
    if(c3D.style.display=="none"){
        c2D.style.display="none";
        c3D.style.display="block";
        if(!scene) init3D();
    } else{
        c2D.style.display="block";
        c3D.style.display="none";
    }
}

function init3D(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x020617);
    camera = new THREE.PerspectiveCamera(60, window.innerWidth/1000,0.1,1000);
    camera.position.set(20,20,20);

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(document.getElementById("graph3D").clientWidth,500);
    document.getElementById("graph3D").appendChild(renderer.domElement);

    controls = new THREE.OrbitControls(camera,renderer.domElement);

    // Axes
    const axes = new THREE.AxesHelper(10);
    scene.add(axes);

    // Exemple surface z = sin(sqrt(x^2+y^2))
    const geometry = new THREE.PlaneGeometry(20,20,100,100);
    geometry.rotateX(-Math.PI/2);
    const material = new THREE.MeshBasicMaterial({color:0x38bdf8,wireframe:true});
    const plane = new THREE.Mesh(geometry,material);
    scene.add(plane);

    animate3D();
}

function animate3D(){
    requestAnimationFrame(animate3D);
    renderer.render(scene,camera);
}
</script>
</body>
</html>
